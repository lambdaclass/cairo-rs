use felt::Felt252;
use num_traits::Zero;

/*
def pack_512(d0, d1,d2,d3, num_bits_shift: int) -> int:
    limbs = (d0, d1, d2, d3)
    return sum(limb << (num_bits_shift * i) for i, limb in enumerate(limbs))

*/
#[allow(dead_code)]
fn pack_512(limbs: [Felt252; 4], num_bits_shift: usize) -> Felt252 {
    let mut result = Felt252::zero();
    for (i, limb) in limbs.iter().enumerate() {
        result += limb << (num_bits_shift * i);
    }
    result
}

#[cfg(test)]
mod tests {
    use num_traits::{FromPrimitive, Num};

    use super::*;

    #[test]
    fn test_pack_512() {
        assert_eq!(
            pack_512(
                [
                    Felt252::new(13123),
                    Felt252::new(534354),
                    Felt252::new(9901823),
                    Felt252::new(7812371)
                ],
                2
            ),
            Felt252::new(660571451)
        );
        assert_eq!(
            pack_512(
                [
                    Felt252::new(13123),
                    Felt252::new(534354),
                    Felt252::new(9901823),
                    Felt252::new(7812371)
                ],
                76
            ),
            Felt252::from_str_radix(
                "3369937688063908975412897222574435556910082026593269572342866796946053411651",
                10
            )
            .unwrap()
        );

        assert_eq!(
            pack_512(
                [
                    Felt252::new(90812398),
                    Felt252::new(55),
                    Felt252::new(83127),
                    Felt252::from_i128(45312309123).unwrap()
                ],
                761
            ),
            Felt252::from_str_radix("80853029148137605102740201774483901385926652025450340798711030404174727480763870493377667725625759764292622444803788021444434452626041518098606806141685367065099387655302625873713592439838446220691925786159227082298892378981461987274693629088875674987359669209043388107114325450518636532594445145924759095125734364345163525655691027843325303271775064263282011908012871334532482494107608759994020937000541268185418760956243245766874157401648637158526410360988956699864519559367805347900540475245570833510432301935056255005826223734865268553682118180231081037207280009003811438596531432027766301678781550463988061852846171462460595592799020846810683500364584025173048032553173114469560143047387885550", 10).unwrap()
        );
    }
}
